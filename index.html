<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Se a bag pesar</title>
  <style>
    /* Mantenha todos os estilos CSS originais */
    body {
      margin: 0;
      font-family: 'Courier New', Courier, monospace;
      background-color: #000;
      color: #0f0;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
      padding: 20px;
    }
    .hidden { display: none; }
    button {
      margin-top: 20px;
      padding: 12px 24px;
      background-color: #0f0;
      border: none;
      color: #000;
      font-weight: bold;
      cursor: pointer;
      font-size: 1rem;
    }
    /* ... (mantenha todos os outros estilos) ... */
  </style>
</head>
<body>
  <!-- Mantenha todo o HTML original -->
  <img id="backgroundGif" src="https://media0.giphy.com/media/v1.Y2lkPTc5MGI3NjExNmM4YmhsazhubjR1YThjeDd2dGlwem1nbmZ5ZHN2NWcwMWNlaDgzaiZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9cw/UurMzl2Xbo7AuVigoh/giphy.gif" />

  <div id="container">
    <!-- Todo o conteúdo HTML original aqui -->
  </div>

  <script type="module">
    // Configuração do Firebase com tratamento de erro
    let db;
    try {
      import { initializeApp } from "https://www.gstatic.com/firebasejs/11.7.3/firebase-app.js";
      import { getDatabase } from "https://www.gstatic.com/firebasejs/11.7.3/firebase-database.js";
      
      const firebaseConfig = {
        apiKey: "AIzaSyAH6bRDAGuKVdv6XDWkrwpX-prapchLYTw",
        authDomain: "se-a-bag-pesar.firebaseapp.com",
        databaseURL: "https://se-a-bag-pesar-default-rtdb.firebaseio.com",
        projectId: "se-a-bag-pesar",
        storageBucket: "se-a-bag-pesar.firebasestorage.app",
        messagingSenderId: "925392204050",
        appId: "1:925392204050:web:006c6d987578316d8e03cb",
        measurementId: "G-EBEW6G9LYJ"
      };
      
      const app = initializeApp(firebaseConfig);
      db = getDatabase(app);
    } catch (error) {
      console.error("Erro ao carregar Firebase:", error);
    }

    // Função para obter IP com fallback
    async function getPlayerIP() {
      try {
        const response = await fetch('https://api.ipify.org?format=json', {
          method: 'GET',
          headers: { 'Content-Type': 'application/json' },
          timeout: 2000 // Timeout de 2 segundos
        });
        
        if (!response.ok) throw new Error('Resposta não OK');
        
        const data = await response.json();
        return data.ip;
      } catch (error) {
        console.warn("Não foi possível obter IP, usando fallback:", error);
        // Gera um IP temporário único
        return 'temp-ip-' + Math.random().toString(36).substr(2, 9);
      }
    }

    // Função startQuiz totalmente revisada
    async function startQuiz() {
      const nameInput = document.getElementById('playerName');
      const name = nameInput ? nameInput.value.trim() : '';
      
      if (!name) {
        alert('Por favor, digite seu nome para começar.');
        return;
      }

      try {
        const ip = await getPlayerIP();
        console.log("IP do jogador:", ip);

        // Verificação opcional de IP no Firebase
        if (db) {
          try {
            import { ref, get } from "https://www.gstatic.com/firebasejs/11.7.3/firebase-database.js";
            const ipRef = ref(db, 'ips/' + ip);
            const ipSnap = await get(ipRef);
            
            if (ipSnap.exists()) {
              const ipWarning = document.getElementById('ipWarning');
              if (ipWarning) ipWarning.style.display = 'block';
              return;
            }
          } catch (firebaseError) {
            console.warn("Erro ao verificar IP no Firebase:", firebaseError);
          }
        }

        // Transição para o quiz
        const intro = document.getElementById('intro');
        const quiz = document.getElementById('quiz');
        
        if (intro) intro.classList.add('hidden');
        if (quiz) {
          quiz.classList.remove('hidden');
          showQuestion(0); // Mostra a primeira pergunta
        }

      } catch (error) {
        console.error("Erro ao iniciar quiz:", error);
        alert("Erro ao iniciar. Recarregue a página e tente novamente.");
      }
    }

    // Função showQuestion simplificada
    function showQuestion(index) {
      const questions = document.querySelectorAll('.question');
      const submitBtn = document.getElementById('submitBtn');
      
      // Esconde todas as perguntas
      questions.forEach(q => q.classList.add('hidden'));
      
      // Mostra a pergunta atual
      if (questions[index]) {
        questions[index].classList.remove('hidden');
      }
      
      // Mostra botão submit apenas na última pergunta
      if (submitBtn) {
        submitBtn.classList.toggle('hidden', index !== questions.length - 1);
      }
    }

    // Event listener seguro para o botão
    document.getElementById('startBtn')?.addEventListener('click', () => {
      startQuiz().catch(e => console.error("Erro no clique:", e));
    });

    // Event listeners para as respostas
    document.querySelectorAll('#quiz input[type=radio]').forEach(input => {
      input.addEventListener('change', () => {
        const currentQuestion = document.querySelector('.question:not(.hidden)');
        if (currentQuestion) {
          const nextIndex = parseInt(currentQuestion.id.substr(1)) - 1 + 1;
          showQuestion(nextIndex);
        }
      });
    });

    // Restante do seu código original (checkAnswers, loadLeaderboard, etc.)
    // ... (mantenha todas as outras funções)
  </script>
</body>
</html>
